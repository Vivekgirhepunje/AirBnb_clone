<% layout("/layouts/boilerplate") %>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center">
            
            <!-- Image -->
            <img src="<%= listing.image.url %>" 
                 alt="<%= listing.title %>" 
                 class="img-fluid rounded shadow mb-4"
                 style="max-height: 300px; min-width:350px; object-fit: cover;">

            <!-- Buttons -->
            <div class="mb-3">
                <form style="display: inline-block;" method="get" action="/listings/<%= listing._id %>/edit">
                    <button class="btn btn-primary me-2">Edit Listing</button>
                </form>
                <form style="display: inline-block;" method="post" action="/listings/<%= listing._id %>?_method=DELETE">
                    <button class="btn edit-btn">Delete Listing</button>
                </form>
            </div>

            <!-- Info -->
            <h3 class="fw-bold"><%= listing.title %></h3>
            <p class="text-muted"><%= listing.description %></p>
            <h4 class="text-success mb-2">&#8377; <%= listing.price.toLocaleString('en-IN') %></h4>
            <p class="mb-1"><i class="fa-solid fa-location-dot"></i> <%= listing.location %></p>
            <p><i class="fa-solid fa-flag"></i> <%= listing.country %></p>

            <!-- Leave Your Review -->
<div class="card shadow-sm mt-4">
    <div class="card-body">
        <h5 class="fw-bold mb-3 text-start">Leave Your Review</h5>
        <form action="/listings/<%= listing._id %>/reviews" method="POST" class="text-start  needs-validation" novalidate>
            
            <!-- Rating -->
            <div class="mb-3">
                <label for="rating" class="form-label fw-semibold">Rating: 
                    <span id="ratingValue" class="ms-2">3</span>/5
                </label>
                <input type="range" 
                       id="rating" 
                       name="review[rating]" 
                       class="form-range" 
                       min="1" max="5" step="1" value="3"
                       oninput="document.getElementById('ratingValue').innerText = this.value">
            </div>

            <!-- Comment -->
            <div class="mb-3">
                <label for="comment" class="form-label fw-semibold">Your Comment</label>
                <textarea required id="comment" name="review[comment]" rows="3" class="form-control" placeholder="Write your thoughts..." ></textarea>
                <div class="invalid-feedback">Please add some comments for review</div>
            </div>

            <!-- Submit -->
            <div class="text-left">
                <button type="submit" class="btn btn-outline-success">Submit Review</button>
            </div>
        </form>
    </div>
</div>

<!-- Reviews Section -->
<div class="mt-4">
  <h5 class="fw-bold mb-3 text-start">Reviews</h5>

  <% if (listing.reviews.length > 0) { %>
    <div class="row">
      <% listing.reviews.forEach(review => { %>
        <div class="col-md-6 mb-3">
          <div class="card h-100 shadow-sm rounded-2">
            <div class="card-body border border-md-black ">
              <p class="fw-semibold mb-1">Rating: <%= review.rating %>/5</p>
              <p class="text-muted mb-0"><%= review.comment %></p>
              <form  action='/listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE' method="post"><button class="btn btn-danger">Delete</button></form>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <p class="text-muted">No reviews yet. Be the first to leave one!</p>
  <% } %>
</div>


        </div>
    </div>
</div>
